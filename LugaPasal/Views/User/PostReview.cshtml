@model LugaPasal.Models.ReviewModel

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        @TempData["SuccessMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        @TempData["ErrorMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

<div class="d-flex justify-content-center my-5">
    <div class="hover-shadow w-100" style="max-width:600px;">
        <div class="card shadow-lg rounded-5 p-0">
            <!-- Gradient Header -->
            <div class="gradient-header rounded-top">
                <h5 class="mb-0 text-uppercase text-center header-title">📝 Write a Review for @Model.product.ProductName</h5>
            </div>

            <form asp-action="PostReview" asp-controller="User" method="post" class="p-4">
                <input type="hidden" value="@Model.product.ProductID" name="id" />
                <input type="hidden" name="ratingValue" id="ratingInput" value="@Model.RatingValue" />

                <!-- Review Textarea -->
                <div class="mb-4">
                    <label class="form-label fw-semibold">Review Description</label>
                    <textarea class="form-control rounded-4 shadow-sm" style="resize:none; min-height:120px; padding:12px;" name="Review" placeholder="Write your review here...">@Model.Review</textarea>
                </div>

                <!-- Star Rating -->
                <div class="mb-4 d-flex align-items-center">
                    @for (int i = 1; i <= 5; i++)
                    {
                        string starClass;
                        if (i <= Model.RatingValue)
                            starClass = "bi-star-fill text-warning";
                        else if (i - Model.RatingValue < 1)
                            starClass = "bi-star-half text-warning";
                        else
                            starClass = "bi-star text-warning";

                        <button type="button" value="@i" class="btn btn-link p-0 me-2 star-btn" style="font-size:2rem;">
                            <i class="bi @starClass" ></i>
                        </button>
                    }
                    <span id="ratingLabel" class="ms-3 fw-bold text-muted" style="font-size:1.2rem;">@Model.RatingValue / 5</span>
                </div>

                <!-- Submit + Back Buttons -->
                <div class="d-flex justify-content-between">
                    <button type="submit" class="btn btn-success rounded-4 px-4 py-2 fw-semibold shadow-sm">Submit</button>
                    <a asp-action="ProductProfile" asp-controller="Product" asp-route-id="@Model.product.ProductID" class="btn btn-outline-secondary rounded-4 px-4 py-2 fw-semibold">Back</a>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
    body {
        background-color: #f0f2f5;
    }

    /* Gradient header */
    .gradient-header {
        background: linear-gradient(90deg, #403A3E, #BE5869);
        color: white;
        padding: 1.2rem;
        border-radius: 1rem 1rem 0 0; /* top corners rounded */
    }

    .header-title {
        letter-spacing: 2px;
        font-family: 'Gill Sans', 'Trebuchet MS', sans-serif;
    }

    .star-btn:focus,
    .star-btn:active {
        outline: none !important;
        box-shadow: none !important;
    }


    .star-btn i {
        transition: color 0.2s ease, transform 0.2s ease !important;
        color: #ffc107;
        display: inline-block; /* This is the key fix! */
    }

    .star-btn:hover i {

        transform: scale(1.2) !important;
        filter: brightness(1.2);
    }

        .star-btn:hover i.bi-star {
            transform: scale(1.3) !important;
        }

    /* Textarea focus */
    textarea:focus {
        border-color: #0d6efd;
        box-shadow: 0 0 0 0.2rem rgba(13,110,253,.25);
    }
</style>

<script>
    const stars = document.querySelectorAll('.star-btn');
    const ratingInput = document.getElementById('ratingInput');
    const ratingLabel = document.getElementById('ratingLabel');

    stars.forEach((btn, index) => {
        btn.addEventListener('click', function () {
            const ratingValue = parseInt(this.value);
            ratingInput.value = ratingValue;
            ratingLabel.textContent = ratingValue + " / 5";

            stars.forEach((starBtn, i) => {
                const icon = starBtn.querySelector('i');
                  icon.classList.remove('bi-star', 'bi-star-fill', 'bi-star-half');
                if (i < ratingValue) {
                    icon.classList.add('bi-star-fill')
                }
                else{
                   icon.classList.add('bi-star');
                }
                icon.classList.add('text-warning');
            });
        });
    });
</script>
